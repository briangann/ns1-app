{"version":3,"sources":["../../../src/components/snaptask/snaptask_list.js"],"names":["slugify","str","slug","replace","SnapTaskListCtrl","$scope","$injector","backendSrv","alertSrv","pageReady","tasks","getTasks","self","get","metric","then","resp","body","task","delete","id","meta","code","set","enabled","put","name","substring","type","getType","config","jobName","zone","templateUrl"],"mappings":"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","file":"snaptask_list.js","sourcesContent":["\nfunction slugify(str) {\n\tvar slug = str.replace(\"@\", \"at\").replace(\"&\", \"and\").replace(\".\", \"_\").replace(\"/\\W+/\", \"\");\n\treturn slug;\n}\n\nclass SnapTaskListCtrl {\n  constructor($scope, $injector, backendSrv, alertSrv) {\n  \tthis.backendSrv = backendSrv;\n    this.alertSrv = alertSrv;\n    this.pageReady = false;\n    this.tasks = [];\n\n    this.getTasks();\n  }\n\n  getTasks() {\n    var self = this;\n    return this.backendSrv.get(\"api/plugin-proxy/ns1-app/tasks\", {metric: \"/raintank/apps/ns1/*\"})\n    .then((resp) => {\n      self.tasks = resp.body;\n\t\t\tself.pageReady = true;\n    });\n  }\n\n  removeTask(task) {\n  \tvar self = this;\n    return this.backendSrv.delete(\"api/plugin-proxy/ns1-app/tasks/\"+task.id).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to delete task\", resp, 'error', 10000);\n      }\n      self.getTasks();\n    });\n  }\n\n  stopTask(task) {\n    var self = this;\n  \ttask.enabled = false;\n    return this.backendSrv.put(\"api/plugin-proxy/ns1-app/tasks\", task).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to stop task\", resp, 'error', 10000);\n        self.getTasks();\n      }\n    });\n  }\n  startTask(task) {\n    var self = this;\n  \ttask.enabled = true;\n    return this.backendSrv.put(\"api/plugin-proxy/ns1-app/tasks\", task).then((resp) => {\n      if (resp.meta.code !== 200) {\n        self.alertSrv.set(\"failed to start task\", resp, 'error', 10000);\n        self.getTasks();\n      }\n    });\n  }\n\n  getType(task) {\n  \tif (task.name.substring(0,14) === \"ns1-monitoring\") {\n  \t\treturn \"monitoringJob\";\n  \t}\n\t\tif (task.name.substring(0,8) === \"ns1-zone\") {\n  \t\treturn \"zone\";\n  \t}\n  \treturn \"\";\n  }\n\n  taskDashboard(task) {\n  \tvar type =this.getType(task)\n  \tif ( type === \"monitoringJob\") {\n  \t\treturn \"dashboard/db/ns1-monitors?&var-monitor=\" + slugify(task.config['/raintank/apps/ns1'].jobName);\n  \t} else if (type == \"zone\") {\n  \t\treturn \"dashboard/db/ns1-zones?&var-zone=\" + slugify(task.config['/raintank/apps/ns1'].zone);\n  \t}\n  }\n\n  taskLabel(task) {\n  \tvar type =this.getType(task)\n  \tif ( type === \"monitoringJob\") {\n  \t\treturn \"Monitoring Job: \"+ task.config['/raintank/apps/ns1'].jobName;\n  \t} else if (type == \"zone\") {\n  \t\treturn \"Zone: \"+ task.config['/raintank/apps/ns1'].zone;\n  \t}\n  }\n}\n\nSnapTaskListCtrl.templateUrl = 'public/plugins/ns1-app/components/snaptask/partials/snaptask_list.html';\nexport {SnapTaskListCtrl};\n"]}